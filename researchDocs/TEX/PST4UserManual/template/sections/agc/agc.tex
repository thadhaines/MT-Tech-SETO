\pagebreak
\section{Automatic Generation Control}  
Automatic generation control (AGC) is an extended-term model that acts to restore system frequency and area interchange values to set values over the course of minutes.
This restoration is accomplished by calculating an area control error (ACE) that is distributed to controlled generation sources to correct any deviation from reference values.

%model calculates an area control error (ACE) and distributes it to defined controlled generators according to participation factor.
%The ACE signal is passed through a PI filter before being distributed to each generator through a unique low pass filter that adds the negative of the value to the governor \verb|tg_sig| value.
%( NOTE: the \verb|tg_sig| value is equivalent to an addition to the governors $P_{ref}$ value)
%The \verb|agc_indx| function creates the required data structures and indices.

%==========================================================================
\input{sections/agc/blockDiagramExplained}

%==========================================================================
\pagebreak
\subsection{Weighted Average Frequency (calcAveF)} 
An inertia weighted average frequency is used as the `actual' frequency $\omega$ in ACE calculations.
The \verb|calcAveF| function calculates an average weighted frequency for the total system and for each area (if areas are defined).
System values are stored in \verb|g.sys.aveF| and area values are stored in \verb|g.area.area(x).aveF| where \verb|x| is the area number.
The calculation involves a sum of system inertias that changes with generator trips.


\vspace{1em}
In a system with $N$ generators, $M$ areas, and $N_M$ generators in area $M$, the \verb|calcAveF| function performs the following calculations for each area $M$:

\begin{equation}{\label{eq: areaH} }
H_{tot_M} = \sum_{i}^{N_M} MVA_{base_i}H_i
\end{equation}\eqcaption{Area Inertia Calculation} 
\vspace{-1em}
\begin{equation}{\label{eq: areaF} }
F_{ave_M} = \left( \sum_{i}^{N_M}Mach_{speed_i}MVA_{base_i}H_i \right) \dfrac{1}{H_{tot_M}}
\end{equation}\eqcaption{Area Average System Frequency Calculation}
\vspace{0.5 em}

\noindent System total values are calculated as:

\begin{equation}{\label{eq: systemH} }
H_{tot} = \sum_{i}^{M} H_{tot_M}
\end{equation}\eqcaption{System Inertia Calculation} 
\vspace{-1em}
\begin{equation}{\label{eq: systemF} }
F_{ave} = \left( \sum_{i}^{M} F_{ave_M} \right) \dfrac{1}{M}
\end{equation}\eqcaption{System Average System Frequency Calculation}
\vspace{0.5 em}

\noindent If $M==0$ (areas are not defined), \verb|calcAveF| performs:

\begin{equation}{\label{eq: systemH2} }
H_{tot} = \sum_{i}^{N} MVA_{base_i}H_i 
\end{equation}\eqcaption{Area-less System Inertia Calculation} 
\vspace{-1em}
\begin{equation}{\label{eq: systemF2} }
F_{ave} = \left( \sum_{i}^{N}Mach_{speed_i}MVA_{base_i}H_i \right) \dfrac{1}{H_{tot}}
\end{equation}\eqcaption{Area-less System Average System Frequency Calculation}\vspace{0.5 em}

\pagebreak
%==================================================
\subsection{Other Area Calculations (calcAreaVals)}  
The \verb|calcAreaVals| function calculates real and reative power generated by all area machines and actual area interchange every time step.
It should be noted that power injected via loads, pwrmod, or ivmmod are not included in the \verb|g.area.area(n).totGen(k)| value.
An area's actual interchange is calculated using the \verb|line_pq2| function to collect area to area line power flows.

